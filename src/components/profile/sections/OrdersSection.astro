---
const title = 'Mis Pedidos';
const statusOptions = ['Todos los estados', 'Pendientes', 'Procesando', 'En camino', 'Entregados', 'Cancelados'];
---

<section class="space-y-4">
  <!-- Header compacto y elegante -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4 pb-3 border-b border-gray-200">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
        <svg class="w-6 h-6 text-[#5d3fbb]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
        </svg>
        {title}
      </h1>
      <p class="text-xs text-gray-500 mt-1 uppercase tracking-wide">Gestiona y rastrea todos tus pedidos</p>
    </div>
  </div>

  <!-- Barra de búsqueda y filtros compactos -->
  <div class="flex flex-col sm:flex-row gap-3">
    <!-- Barra de búsqueda elegante -->
    <div class="flex-1 relative">
      <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
      <input
        type="text"
        id="search-input"
        placeholder="Buscar pedido o producto..."
        class="w-full pl-10 pr-4 py-2.5 text-sm rounded-lg border border-gray-200 bg-white text-gray-900 placeholder-gray-400 focus:border-[#5d3fbb] focus:outline-none focus:ring-2 focus:ring-[#5d3fbb]/20 transition-all duration-200"
      />
    </div>

    <!-- Dropdown de filtros elegante -->
    <div class="relative" id="filter-dropdown-container">
      <button
        type="button"
        id="status-filter-btn"
        class="flex items-center gap-2 px-4 py-2.5 min-w-[160px] text-sm rounded-lg border border-gray-200 bg-white text-gray-700 hover:border-[#5d3fbb] hover:bg-[#5d3fbb]/5 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-[#5d3fbb]/20 justify-between"
      >
        <span id="status-filter-text" class="font-medium">Todos los estados</span>
        <svg class="h-4 w-4 text-gray-400 transition-transform duration-200" id="status-filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
      
      <!-- Menú dropdown elegante -->
      <div
        id="status-dropdown-menu"
        class="hidden absolute top-full left-0 mt-1.5 w-full bg-white border border-gray-200 rounded-lg shadow-xl z-50 overflow-hidden"
      >
        {statusOptions.map((status) => (
          <button
            type="button"
            class="filter-option w-full text-left px-4 py-2.5 text-sm hover:bg-[#5d3fbb]/5 transition-colors duration-150 flex items-center justify-between"
            data-status={status === 'Todos los estados' ? 'all' : status.toLowerCase()}
          >
            <span class="font-medium">{status}</span>
            <svg class="h-4 w-4 text-[#5d3fbb] check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style={status === 'Todos los estados' ? '' : 'display: none;'}>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </button>
        ))}
      </div>
    </div>
  </div>

  <!-- Loading State elegante -->
  <div id="orders-loading" class="flex items-center justify-center min-h-[300px]">
    <div class="text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-2 border-[#5d3fbb] border-t-transparent mb-3"></div>
      <p class="text-sm text-gray-500 font-medium">Cargando pedidos...</p>
    </div>
  </div>

  <!-- Error State elegante -->
  <div id="orders-error" class="hidden text-center py-16">
    <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-50 mb-4">
      <svg class="h-6 w-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </div>
    <p class="text-gray-900 font-semibold mb-1">Error al cargar los pedidos</p>
    <p class="text-sm text-gray-500 mb-4" id="orders-error-message"></p>
    <button
      id="orders-retry-btn"
      class="px-5 py-2 text-sm font-medium bg-[#5d3fbb] text-white rounded-lg hover:bg-[#4d2fa8] transition-colors duration-200"
    >
      Reintentar
    </button>
  </div>

  <!-- Contenedor de pedidos compacto -->
  <div id="orders-container" class="hidden space-y-3 min-h-[300px]">
    <!-- Los pedidos se renderizarán aquí con JavaScript -->
  </div>

  <!-- Mensaje cuando no hay pedidos elegante -->
  <div id="no-orders-message" class="hidden text-center py-16">
    <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-50 mb-4">
      <svg class="h-6 w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
      </svg>
    </div>
    <p class="text-gray-900 font-semibold mb-1">No se encontraron pedidos</p>
    <p class="text-sm text-gray-500">Intenta cambiar los filtros de búsqueda</p>
  </div>

  <!-- Modal de Calificación elegante -->
  <div id="rating-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4" style="display: none;">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
      <!-- Título -->
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-xl font-bold text-gray-900">Calificar Pedido</h2>
        <button type="button" onclick="closeRatingModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <!-- Estrellas de calificación compactas -->
      <div class="flex items-center justify-center gap-1 mb-5" id="rating-stars">
        <button type="button" class="star-btn text-2xl text-gray-300 hover:scale-110 transition-transform duration-200" data-rating="1" aria-label="1 estrella">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
        </button>
        <button type="button" class="star-btn text-2xl text-gray-300 hover:scale-110 transition-transform duration-200" data-rating="2" aria-label="2 estrellas">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
        </button>
        <button type="button" class="star-btn text-2xl text-gray-300 hover:scale-110 transition-transform duration-200" data-rating="3" aria-label="3 estrellas">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
        </button>
        <button type="button" class="star-btn text-2xl text-gray-300 hover:scale-110 transition-transform duration-200" data-rating="4" aria-label="4 estrellas">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
        </button>
        <button type="button" class="star-btn text-2xl text-gray-300 hover:scale-110 transition-transform duration-200" data-rating="5" aria-label="5 estrellas">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
          </svg>
        </button>
      </div>
      
      <!-- Textarea de comentarios elegante -->
      <div class="mb-5">
        <textarea
          id="rating-comment"
          placeholder="Comparte tu experiencia..."
          class="w-full h-24 px-4 py-3 text-sm rounded-lg border border-gray-200 bg-white text-gray-900 placeholder-gray-400 focus:border-[#5d3fbb] focus:outline-none focus:ring-2 focus:ring-[#5d3fbb]/20 transition-all duration-200 resize-none"
        ></textarea>
      </div>
      
      <!-- Botones de acción elegantes -->
      <div class="flex gap-2">
        <button
          type="button"
          id="rating-cancel-btn"
          class="flex-1 px-4 py-2.5 text-sm font-semibold bg-white text-gray-700 border border-gray-200 rounded-lg hover:border-gray-300 hover:bg-gray-50 transition-all duration-200 active:scale-95"
        >
          Cancelar
        </button>
        <button
          type="button"
          id="rating-submit-btn"
          class="flex-1 px-4 py-2.5 text-sm font-semibold bg-[#5d3fbb] text-white rounded-lg hover:bg-[#4d2fa8] transition-all duration-200 active:scale-95"
        >
          Enviar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Solicitud de Devolución -->
  <div id="return-request-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4" style="display: none;">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-5 sm:p-6">
      <!-- Título -->
      <div class="flex items-center justify-between mb-5">
        <h2 class="text-xl font-bold text-gray-900">Solicitar Devolución</h2>
        <button type="button" id="return-modal-close-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <!-- Información del pedido -->
      <div id="return-order-info" class="mb-5 p-4 bg-gray-50 rounded-lg">
        <!-- Se llenará dinámicamente -->
      </div>

      <!-- Selección de productos -->
      <div class="mb-5">
        <label class="block text-sm font-semibold text-gray-900 mb-3">Selecciona el producto a devolver:</label>
        <div id="return-products-list" class="space-y-2 max-h-48 overflow-y-auto">
          <!-- Se llenará dinámicamente -->
        </div>
      </div>

      <!-- Razón de devolución -->
      <div class="mb-5">
        <label for="return-reason" class="block text-sm font-semibold text-gray-900 mb-2">
          Razón de la devolución <span class="text-red-500">*</span>
        </label>
        <select
          id="return-reason"
          class="w-full px-4 py-2.5 text-sm rounded-lg border border-gray-200 bg-white text-gray-900 focus:border-[#5d3fbb] focus:outline-none focus:ring-2 focus:ring-[#5d3fbb]/20 transition-all"
          required
        >
          <option value="">Selecciona una razón</option>
          <option value="defective">Producto defectuoso</option>
          <option value="wrong_item">Pedido incorrecto</option>
          <option value="damaged">Producto dañado</option>
          <option value="not_as_described">No coincide con la descripción</option>
          <option value="other">Otra razón</option>
        </select>
      </div>

      <!-- Descripción -->
      <div class="mb-5">
        <label for="return-description" class="block text-sm font-semibold text-gray-900 mb-2">
          Descripción detallada <span class="text-red-500">*</span>
        </label>
        <textarea
          id="return-description"
          placeholder="Describe el problema o razón de la devolución..."
          class="w-full h-32 px-4 py-3 text-sm rounded-lg border border-gray-200 bg-white text-gray-900 placeholder-gray-400 focus:border-[#5d3fbb] focus:outline-none focus:ring-2 focus:ring-[#5d3fbb]/20 transition-all duration-200 resize-none"
          required
        ></textarea>
      </div>
      
      <!-- Botones de acción -->
      <div class="flex gap-2">
        <button
          type="button"
          id="return-cancel-btn"
          class="flex-1 px-4 py-2.5 text-sm font-semibold bg-white text-gray-700 border border-gray-200 rounded-lg hover:border-gray-300 hover:bg-gray-50 transition-all duration-200 active:scale-95"
        >
          Cancelar
        </button>
        <button
          type="button"
          id="return-submit-btn"
          class="flex-1 px-4 py-2.5 text-sm font-semibold bg-[#5d3fbb] text-white rounded-lg hover:bg-[#4d2fa8] transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Enviar Solicitud
        </button>
      </div>
    </div>
  </div>

  <!-- Paginación -->
  <div id="pagination-container" class="flex flex-col sm:flex-row items-center justify-between gap-4 mt-6 pt-6 border-t border-gray-200">
    <div class="text-sm text-gray-600">
      Mostrando <span id="pagination-start">0</span> - <span id="pagination-end">0</span> de <span id="pagination-total">0</span> pedidos
    </div>
    <div class="flex items-center gap-2">
      <button
        id="prev-page-btn"
        type="button"
        class="px-4 py-2 rounded-lg border-2 border-gray-200 bg-white text-gray-700 hover:border-purple-400 hover:bg-purple-50 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        disabled
      >
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <div id="pagination-numbers" class="flex items-center gap-1">
        <!-- Los números de página se generarán con JavaScript -->
      </div>
      <button
        id="next-page-btn"
        type="button"
        class="px-4 py-2 rounded-lg border-2 border-gray-200 bg-white text-gray-700 hover:border-purple-400 hover:bg-purple-50 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>

  <script>
    import "../../../scripts/profile/orders";
  </script>

</section>

